<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>flash</title>
<link rel="stylesheet" href="doc.css">
</head>
<body>
<h1>flash</h1>
<pre class="forth">
<font color=black>
<hr>

</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>SPI flash memory interface                                    9/22/20 BNE 

</font><font color=#00AAAA><a href = "root.html#1.1290" style="text-decoration: none; color: #00AAAA">there</a> 

</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>I/O registers       Read        Write 
</font><font color=#AA0000>4 </font><font color=#00AAAA><a href = "root.html#1.0140" style="text-decoration: none; color: #00AAAA">equ</a> </font><font color=#AA00AA>SPIdata      &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>retrig      spitx 
</font><font color=#AA0000>5 </font><font color=#00AAAA><a href = "root.html#1.0140" style="text-decoration: none; color: #00AAAA">equ</a> </font><font color=#AA00AA>SPIformat    &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>result      format 
</font><font color=#AA0000>6 </font><font color=#00AAAA><a href = "root.html#1.0140" style="text-decoration: none; color: #00AAAA">equ</a> </font><font color=#AA00AA>SPIrate      &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>            rate 
</font><font color=#AA0000>8 </font><font color=#00AAAA><a href = "root.html#1.0140" style="text-decoration: none; color: #00AAAA">equ</a> </font><font color=#AA00AA>CodeAddr     &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>            cmaddr 
</font><font color=#AA0000>9 </font><font color=#00AAAA><a href = "root.html#1.0140" style="text-decoration: none; color: #00AAAA">equ</a> </font><font color=#AA00AA>CodeData     &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>cmdata      cmdata 

</font><font color=#AA0000>0 </font><font color=#00AAAA><a href = "root.html#1.0140" style="text-decoration: none; color: #00AAAA">equ</a> </font><font color=#AA00AA>S_R8                             &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>8-bit read mode 
</font><font color=#AA0000>1 </font><font color=#00AAAA><a href = "root.html#1.0140" style="text-decoration: none; color: #00AAAA">equ</a> </font><font color=#AA00AA>S_W8                             &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>8-bit write mode 
</font><font color=#AA0000>2 </font><font color=#00AAAA><a href = "root.html#1.0140" style="text-decoration: none; color: #00AAAA">equ</a> </font><font color=#AA00AA>S_R16                            &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>16-bit read mode 
</font><font color=#AA0000>3 </font><font color=#00AAAA><a href = "root.html#1.0140" style="text-decoration: none; color: #00AAAA">equ</a> </font><font color=#AA00AA>S_W16                            &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>16-bit write mode 

</font><font color=#00AAAA><a href = "root.html#1.1130" style="text-decoration: none; color: #00AAAA">variable</a> </font><font color=#AA00AA>qe-flag                       &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>2.4010 -- a-addr 
</font><font color=#00AAAA><a href = "root.html#1.1130" style="text-decoration: none; color: #00AAAA">variable</a> </font><font color=#AA00AA>stream-handle                 &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>2.4020 -- a-addr 
</font><font color=#AA0000>3 </font><font color=#0000FF><a href = "forth.html#2.0170" style="text-decoration: none; color: #0000FF">cells</a> </font><font color=#00AAAA><a href = "root.html#1.1150" style="text-decoration: none; color: #00AAAA">buffer:</a> </font><font color=#AA00AA>stream-parms 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>stream-mode </font><font color=#AA00AA><a href = "forth.html#2.4020" style="text-decoration: none; color: #AA00AA">stream-handle</a> </font><font color=#0000FF><a href = "forth.html#2.0210" style="text-decoration: none; color: #0000FF">@</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>stream-ptr  </font><font color=#AA00AA><a href = "forth.html#2.4020" style="text-decoration: none; color: #AA00AA">stream-handle</a> </font><font color=#0000FF><a href = "forth.html#2.0210" style="text-decoration: none; color: #0000FF">@</a> <a href = "forth.html#2.0160" style="text-decoration: none; color: #0000FF">cell+</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>stream-cell </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">stream-mode</a> <a href = "forth.html#2.0210" style="text-decoration: none; color: #0000FF">@</a> </font><font color=#AA0000>2 </font><font color=#FF00FF><a href = "root.html#1.2070" style="text-decoration: none; color: #FF00FF">and</a> <a href = "root.html#1.2030" style="text-decoration: none; color: #FF00FF">2/</a> </font><font color=#AA0000>1 </font><font color=#FF00FF><a href = "root.html#1.2080" style="text-decoration: none; color: #FF00FF">+</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> <a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>-- n \ bytes per stream element 

</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>readSPI    &nbsp;</font><font color=#AA00AA><a href = "forth.html#(null)" style="text-decoration: none; color: #AA00AA">SPIformat</a> </font><font color=#0000FF><a href = "forth.html#2.0110" style="text-decoration: none; color: #0000FF">io@</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a>          &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>-- c \ result of transfer 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>SPI[       &nbsp;</font><font color=#AA0000>1 </font><font color=#AA00AA><a href = "forth.html#(null)" style="text-decoration: none; color: #AA00AA">SPIformat</a> </font><font color=#0000FF><a href = "forth.html#2.0120" style="text-decoration: none; color: #0000FF">io!</a> </font><font color=#00AAAA><a href = "root.html#1.1170" style="text-decoration: none; color: #00AAAA">[</a> <a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a>      &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>c -- \ activate CS line and send byte 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>sendSPI    &nbsp;</font><font color=#AA00AA><a href = "forth.html#(null)" style="text-decoration: none; color: #AA00AA">SPIdata</a> </font><font color=#0000FF><a href = "forth.html#2.0120" style="text-decoration: none; color: #0000FF">io!</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a>            &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>c -- \ transmit an SPI byte 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>]SPI       &nbsp;</font><font color=#AA0000>0 </font><font color=#AA00AA><a href = "forth.html#(null)" style="text-decoration: none; color: #AA00AA">SPIformat</a> </font><font color=#0000FF><a href = "forth.html#2.0120" style="text-decoration: none; color: #0000FF">io!</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a>        &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>end SPI cycle 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>fl_wren    &nbsp;</font><font color=#AA0000>6 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">SPI[</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">]SPI</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a>            &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>write enable 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>fl_wrdi    &nbsp;</font><font color=#AA0000>4 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">SPI[</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">]SPI</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a>            &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>write disable 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>_fc>       &nbsp;</font><font color=#AA0000>0 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">sendSPI</a>  <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">readSPI</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a>     &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>-- c \ read next flash byte 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>fc>        &nbsp;</font><font color=#AA00AA><a href = "forth.html#(null)" style="text-decoration: none; color: #AA00AA">SPIdata</a> </font><font color=#0000FF><a href = "forth.html#2.0110" style="text-decoration: none; color: #0000FF">io@</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a>            &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>-- c \ read and trigger flash 

</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>Initialize the flash: Read the QE bit and provide a handle 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>/flash           &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>-- 
   &nbsp;</font><font color=#AA0000>53 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">SPI[</a>  <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_fc></a>  </font><font color=#AA0000>2 </font><font color=#FF00FF><a href = "root.html#1.2070" style="text-decoration: none; color: #FF00FF">and</a> </font><font color=#AA00AA><a href = "forth.html#2.4010" style="text-decoration: none; color: #AA00AA">qe-flag</a> </font><font color=#0000FF><a href = "forth.html#2.0200" style="text-decoration: none; color: #0000FF">!</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">]SPI</a> </font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>upper status byte 
   &nbsp;</font><font color=#AA00AA><a href = "forth.html#(null)" style="text-decoration: none; color: #AA00AA">stream-parms</a> <a href = "forth.html#2.4020" style="text-decoration: none; color: #AA00AA">stream-handle</a> </font><font color=#0000FF><a href = "forth.html#2.0200" style="text-decoration: none; color: #0000FF">!</a>       &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>set up a default handle 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 

</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">/flash</a> 
</pre>
</body>
</html>
