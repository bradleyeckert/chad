<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>flash</title>
<link rel="stylesheet" href="doc.css">
</head>
<body>
<h1>flash</h1>
<pre class="forth">
<font color=black>
<hr>

</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>SPI flash access 

</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>Flash addresses are doubles to support 16-bit and 18-bit cell size. 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>Compiled strings (for `type` etc.) are assumed to have 0 for the upper cell 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>of the address. Those strings must be below flash address 2^cellsize. 

</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>Single-byte reads from flash close the SPI flash after reading. 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>There is no assumption of continuity: Font bitmaps may be read between bytes. 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>So, c@f is slow. If you need speed, read flash in chunks. 

</font><font color=#00AAAA><a href = "root.html#1.1290" style="text-decoration: none; color: #00AAAA">there</a> </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">hex</a> 

</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>_isp  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>c --  )              &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>write ISP byte to SPIF 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1170" style="text-decoration: none; color: #00AAAA">[</a> </font><font color=#AA0000>4 </font><font color=#0000FF><a href = "forth.html#2.0170" style="text-decoration: none; color: #0000FF">cells</a> </font><font color=#00AAAA><a href = "root.html#1.1180" style="text-decoration: none; color: #00AAAA">]</a> <a href = "root.html#1.1260" style="text-decoration: none; color: #00AAAA">literal</a> </font><font color=#0000FF><a href = "forth.html#2.0120" style="text-decoration: none; color: #0000FF">io!</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>ispwait  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>--  )             &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>wait for ISP command to finish 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2900" style="text-decoration: none; color: #00AAAA">begin</a>  <a href = "root.html#1.1170" style="text-decoration: none; color: #00AAAA">[</a> </font><font color=#AA0000>4 </font><font color=#0000FF><a href = "forth.html#2.0170" style="text-decoration: none; color: #0000FF">cells</a> </font><font color=#00AAAA><a href = "root.html#1.1180" style="text-decoration: none; color: #00AAAA">]</a> <a href = "root.html#1.1260" style="text-decoration: none; color: #00AAAA">literal</a> </font><font color=#0000FF><a href = "forth.html#2.0110" style="text-decoration: none; color: #0000FF">io@</a>  </font><font color=#00AAAA><a href = "root.html#1.2960" style="text-decoration: none; color: #00AAAA">while</a>  </font><font color=#0000FF><a href = "forth.html#2.0100" style="text-decoration: none; color: #0000FF">noop</a>  </font><font color=#00AAAA><a href = "root.html#1.2970" style="text-decoration: none; color: #00AAAA">repeat</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>ispcmd  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>c --  )            &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>write ISP command 
  &nbsp;</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_isp</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">ispwait</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 

</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>The gecko key is loaded by writing to a register and then triggering a load. 

</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>gkey  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>n --  )              &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>shift in a new key 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1170" style="text-decoration: none; color: #00AAAA">[</a> </font><font color=#AA0000>5 </font><font color=#0000FF><a href = "forth.html#2.0170" style="text-decoration: none; color: #0000FF">cells</a> </font><font color=#00AAAA><a href = "root.html#1.1180" style="text-decoration: none; color: #00AAAA">]</a> <a href = "root.html#1.1260" style="text-decoration: none; color: #00AAAA">literal</a> </font><font color=#0000FF><a href = "forth.html#2.0120" style="text-decoration: none; color: #0000FF">io!</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>)gkey  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>n --  )             &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>re-key the gecko keystream 
  &nbsp;</font><font color=#AA0000>48 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">ispcmd</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>fabyte  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>df-addr shift -- df-addr  )
  &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2170" style="text-decoration: none; color: #FF00FF">>r</a>  </font><font color=#0000FF><a href = "forth.html#2.0330" style="text-decoration: none; color: #0000FF">2dup</a>  </font><font color=#FF00FF><a href = "root.html#1.2180" style="text-decoration: none; color: #FF00FF">r></a> </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">drshift</a> </font><font color=#FF00FF><a href = "root.html#1.2130" style="text-decoration: none; color: #FF00FF">drop</a> </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">ispcmd</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>fcmd24  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>df-addr cmd --  )  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>set start address and set command 
  &nbsp;</font><font color=#AA0000>0 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_isp</a>  </font><font color=#AA0000>3 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_isp</a>  </font><font color=#AA0000>82 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_isp</a>     &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>4 bytes to send 
  &nbsp;</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">ispcmd</a>  </font><font color=#AA0000>10 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">fabyte</a>  </font><font color=#AA0000>8 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">fabyte</a>  </font><font color=#AA0000>0 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">fabyte</a> 
  &nbsp;</font><font color=#0000FF><a href = "forth.html#2.0340" style="text-decoration: none; color: #0000FF">2drop</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 

</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>c@f(  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>df-addr --  )        &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>start 0B read command 
  &nbsp;</font><font color=#AA0000>0B </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">fcmd24</a>  </font><font color=#AA0000>82 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_isp</a>  </font><font color=#AA0000>0 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">ispcmd</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>_c@f  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>-- c  )              &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>read byte from flash 
  &nbsp;</font><font color=#AA0000>60 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">ispcmd</a>                   &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>trigger SPI transfer 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1170" style="text-decoration: none; color: #00AAAA">[</a> </font><font color=#AA0000>3 </font><font color=#0000FF><a href = "forth.html#2.0170" style="text-decoration: none; color: #0000FF">cells</a> </font><font color=#00AAAA><a href = "root.html#1.1180" style="text-decoration: none; color: #00AAAA">]</a> <a href = "root.html#1.1260" style="text-decoration: none; color: #00AAAA">literal</a> </font><font color=#0000FF><a href = "forth.html#2.0110" style="text-decoration: none; color: #0000FF">io@</a>     &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>read SPI result 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>_@f  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>-- n  )               &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>read cell from flash 
  &nbsp;</font><font color=#AA0000>0 </font><font color=#00AAAA><a href = "root.html#1.1170" style="text-decoration: none; color: #00AAAA">[</a> </font><font color=#AA00AA><a href = "root.html#1.0050" style="text-decoration: none; color: #AA00AA">cellbits</a> </font><font color=#AA0000>8 </font><font color=#0000FF><a href = "forth.html#2.0490" style="text-decoration: none; color: #0000FF">/</a> </font><font color=#00AAAA><a href = "root.html#1.1180" style="text-decoration: none; color: #00AAAA">]</a> <a href = "root.html#1.1260" style="text-decoration: none; color: #00AAAA">literal</a> <a href = "root.html#1.2980" style="text-decoration: none; color: #00AAAA">for</a> 
     &nbsp;</font><font color=#AA0000>8 </font><font color=#0000FF><a href = "forth.html#2.1110" style="text-decoration: none; color: #0000FF">lshift</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_c@f</a> </font><font color=#FF00FF><a href = "root.html#1.2080" style="text-decoration: none; color: #FF00FF">+</a> 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2990" style="text-decoration: none; color: #00AAAA">next</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>)c@f  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>--  )                &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>end read 
  &nbsp;</font><font color=#AA0000>80 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_isp</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>c@f  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>df-addr -- c  ) </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">c@f(</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_c@f</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">)c@f</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>@f  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>df-addr -- c  ) </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">c@f(</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_@f</a>  <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">)c@f</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 

</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>fcount  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>df-addr -- df-addr+1 c  )
  &nbsp;</font><font color=#0000FF><a href = "forth.html#2.0330" style="text-decoration: none; color: #0000FF">2dup</a> </font><font color=#AA0000>1 0 </font><font color=#0000FF><a href = "forth.html#2.1130" style="text-decoration: none; color: #0000FF">d+</a>  <a href = "forth.html#2.1190" style="text-decoration: none; color: #0000FF">2swap</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">c@f</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>ftype  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>df-addr u --  )     &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>emit string in flash 
  &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a> </font><font color=#00AAAA><a href = "root.html#1.2930" style="text-decoration: none; color: #00AAAA">if</a> 
     &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2980" style="text-decoration: none; color: #00AAAA">for</a>  </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">fcount</a> <a href = "forth.html#2.2110" style="text-decoration: none; color: #0000FF">emit</a>  </font><font color=#00AAAA><a href = "root.html#1.2990" style="text-decoration: none; color: #00AAAA">next</a> 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2950" style="text-decoration: none; color: #00AAAA">then</a>  </font><font color=#0000FF><a href = "forth.html#2.0340" style="text-decoration: none; color: #0000FF">2drop</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>f$type  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>f-addr --  )       &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>emit the "flash string" 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>  tkey gkey gkey dup gkey )gkey \ set the decryption key 
  &nbsp;</font><font color=#AA0000>0  </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">fcount</a>  <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">ftype</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 

</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>fdump  </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>f-addr len --  )    &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>only useful if tkey is 0 
  &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2110" style="text-decoration: none; color: #FF00FF">over</a> </font><font color=#AA0000>5 </font><font color=#0000FF><a href = "forth.html#2.3320" style="text-decoration: none; color: #0000FF">h.x</a>  </font><font color=#AA0000>0 </font><font color=#FF00FF><a href = "root.html#1.2120" style="text-decoration: none; color: #FF00FF">swap</a> 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2980" style="text-decoration: none; color: #00AAAA">for</a> 
     &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2110" style="text-decoration: none; color: #FF00FF">over</a> </font><font color=#AA0000>0F </font><font color=#FF00FF><a href = "root.html#1.2070" style="text-decoration: none; color: #FF00FF">and</a> <a href = "root.html#1.2150" style="text-decoration: none; color: #FF00FF">0=</a> </font><font color=#00AAAA><a href = "root.html#1.2930" style="text-decoration: none; color: #00AAAA">if</a> </font><font color=#0000FF><a href = "forth.html#2.2111" style="text-decoration: none; color: #0000FF">cr</a> </font><font color=#FF00FF><a href = "root.html#1.2110" style="text-decoration: none; color: #FF00FF">over</a> </font><font color=#AA0000>5 </font><font color=#0000FF><a href = "forth.html#2.3320" style="text-decoration: none; color: #0000FF">h.x</a> </font><font color=#00AAAA><a href = "root.html#1.2950" style="text-decoration: none; color: #00AAAA">then</a> 
     &nbsp;</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">fcount</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">h.2</a> 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2990" style="text-decoration: none; color: #00AAAA">next</a> </font><font color=#0000FF><a href = "forth.html#2.0340" style="text-decoration: none; color: #0000FF">2drop</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 

</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>Header structures are in flash. Up to 8 wordlists may be in the 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>search order. WIDs are indices into `wids`, an array in data space. 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>The name of the wordlist is just before the first link. 

</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>(.wid)  </font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>f-addr --                   \ f-addr points to the link that's 0 
  &nbsp;</font><font color=#0000FF><a href = "forth.html#2.0370" style="text-decoration: none; color: #0000FF">1-</a>  </font><font color=#FF00FF><a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a> </font><font color=#AA0000>0 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">c@f</a>  <a href = "forth.html#2.0390" style="text-decoration: none; color: #0000FF">tuck</a> </font><font color=#FF00FF><a href = "root.html#1.2090" style="text-decoration: none; color: #FF00FF">-</a> </font><font color=#AA0000>0 </font><font color=#0000FF><a href = "forth.html#2.0310" style="text-decoration: none; color: #0000FF">rot</a>         &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>daddr-f len 
  &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a> </font><font color=#AA0000>31 </font><font color=#0000FF><a href = "forth.html#2.0150" style="text-decoration: none; color: #0000FF">></a> </font><font color=#00AAAA><a href = "root.html#1.2930" style="text-decoration: none; color: #00AAAA">if</a> </font><font color=#0000FF><a href = "forth.html#2.0340" style="text-decoration: none; color: #0000FF">2drop</a> </font><font color=#00AAAA><a href = "root.html#1.1160" style="text-decoration: none; color: #00AAAA">[char]</a> </font><font color=#0000FF><a href = "forth.html#2.2110" style="text-decoration: none; color: #0000FF">emit</a> </font><font color=#00AAAA><a href = "root.html#1.1230" style="text-decoration: none; color: #00AAAA">exit</a> <a href = "root.html#1.2950" style="text-decoration: none; color: #00AAAA">then</a> <a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>no name 
  &nbsp;</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">ftype</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>[wid]  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>wid -- addr  )             &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>wid is indexed from 1 
  &nbsp;</font><font color=#0000FF><a href = "forth.html#2.0170" style="text-decoration: none; color: #0000FF">cells</a> </font><font color=#00AAAA><a href = "root.html#1.1170" style="text-decoration: none; color: #00AAAA">[</a> </font><font color=#AA00AA><a href = "root.html#1.0076" style="text-decoration: none; color: #AA00AA">wids</a> <a href = "root.html#1.0060" style="text-decoration: none; color: #AA00AA">cell</a> </font><font color=#FF00FF><a href = "root.html#1.2090" style="text-decoration: none; color: #FF00FF">-</a> </font><font color=#00AAAA><a href = "root.html#1.1180" style="text-decoration: none; color: #00AAAA">]</a> <a href = "root.html#1.1260" style="text-decoration: none; color: #00AAAA">literal</a> </font><font color=#FF00FF><a href = "root.html#1.2080" style="text-decoration: none; color: #FF00FF">+</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>wid   &nbsp;</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">[wid]</a> <a href = "forth.html#2.0210" style="text-decoration: none; color: #0000FF">@</a> </font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a>                     &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>wid -- f-addr 

</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>.wid  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>wid --                       \ display WID identifier (for order) 
  &nbsp;</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">wid</a>  </font><font color=#FF00FF><a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a>                            &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>get the pointer 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2900" style="text-decoration: none; color: #00AAAA">begin</a> </font><font color=#FF00FF><a href = "root.html#1.2140" style="text-decoration: none; color: #FF00FF">nip</a> <a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a> </font><font color=#AA0000>0 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">@f</a> </font><font color=#FF00FF><a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a> <a href = "root.html#1.2150" style="text-decoration: none; color: #FF00FF">0=</a> </font><font color=#00AAAA><a href = "root.html#1.2920" style="text-decoration: none; color: #00AAAA">until</a> </font><font color=#FF00FF><a href = "root.html#1.2130" style="text-decoration: none; color: #FF00FF">drop</a> </font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>skip to beginning 
  &nbsp;</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">(.wid)</a> <a href = "forth.html#2.3160" style="text-decoration: none; color: #0000FF">space</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 

</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>| Length  | Name  | Usage                | 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>| ------- |:-----:| --------------------:| 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>| M bytes | link  | Link to next header  | 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>| 1 byte  | N     | Length of `name`     | 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>| N bytes | name  | Name string          | 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>| M bytes | xte   | *xt* for Execution   | <-- ht 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>| M bytes | xtc   | *xt* for Compilation | 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>| M bytes | w     | Optional data        | 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>| 1 byte  | flags | Packed flags (0=on)  | 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>| 1 byte  | app   | Applet ID            | 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800> 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>For `find`, the SPI read sequence is continued until it doesn't match. 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>`match` compares a key in data space to the flash byte stream. 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>It's a case-sensitive comparison. For a case-insensitive search, insert a 
</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>tolower function. 

</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>match  </font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>addr len -- found? 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2980" style="text-decoration: none; color: #00AAAA">for</a>                                 &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>addr' | len' 
     &nbsp;</font><font color=#0000FF><a href = "forth.html#2.1200" style="text-decoration: none; color: #0000FF">count</a> </font><font color=#00AAAA><a href = "root.html#1.1010" style="text-decoration: none; color: #00AAAA">(</a> </font><font color=#008800>tolower  )</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_c@f</a> </font><font color=#FF00FF><a href = "root.html#1.2060" style="text-decoration: none; color: #FF00FF">xor</a> </font><font color=#00AAAA><a href = "root.html#1.2930" style="text-decoration: none; color: #00AAAA">if</a> 
        &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2710" style="text-decoration: none; color: #FF00FF">rdrop</a> <a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a> <a href = "root.html#1.2060" style="text-decoration: none; color: #FF00FF">xor</a> </font><font color=#00AAAA><a href = "root.html#1.1230" style="text-decoration: none; color: #00AAAA">exit</a>            &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>mismatch in string 
     &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2950" style="text-decoration: none; color: #00AAAA">then</a> 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2990" style="text-decoration: none; color: #00AAAA">next</a>  </font><font color=#FF00FF><a href = "root.html#1.2130" style="text-decoration: none; color: #FF00FF">drop</a> </font><font color=#AA0000>1 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 

</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>Search one wordlist, returning the address of header data. 
</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>_hfind  </font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>addr len wid -- addr len 0 | addr len ht 
  &nbsp;</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">wid</a>  </font><font color=#FF00FF><a href = "root.html#1.2110" style="text-decoration: none; color: #FF00FF">over</a> </font><font color=#AA0000>31 </font><font color=#0000FF><a href = "forth.html#2.1060" style="text-decoration: none; color: #0000FF">u></a> </font><font color=#AA0000>-19 </font><font color=#FF00FF><a href = "root.html#1.2070" style="text-decoration: none; color: #FF00FF">and</a> </font><font color=#0000FF><a href = "forth.html#2.0020" style="text-decoration: none; color: #0000FF">exception</a>   &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>name too long 
  &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2110" style="text-decoration: none; color: #FF00FF">over</a> <a href = "root.html#1.2150" style="text-decoration: none; color: #FF00FF">0=</a> </font><font color=#00AAAA><a href = "root.html#1.2930" style="text-decoration: none; color: #00AAAA">if</a> </font><font color=#FF00FF><a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a> <a href = "root.html#1.2060" style="text-decoration: none; color: #FF00FF">xor</a> </font><font color=#00AAAA><a href = "root.html#1.1230" style="text-decoration: none; color: #00AAAA">exit</a> <a href = "root.html#1.2950" style="text-decoration: none; color: #00AAAA">then</a>        &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>addr 0 0   zero length string 
  &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2900" style="text-decoration: none; color: #00AAAA">begin</a> 
     &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2700" style="text-decoration: none; color: #FF00FF">dup>r</a>  </font><font color=#AA0000>0 </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">c@f(</a>  <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_@f</a> </font><font color=#FF00FF><a href = "root.html#1.2170" style="text-decoration: none; color: #FF00FF">>r</a>  </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_c@f</a>      &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>addr len1 len2 | head link 
     &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2110" style="text-decoration: none; color: #FF00FF">over</a> </font><font color=#0000FF><a href = "forth.html#2.0130" style="text-decoration: none; color: #0000FF">=</a> </font><font color=#00AAAA><a href = "root.html#1.2930" style="text-decoration: none; color: #00AAAA">if</a> 
        &nbsp;</font><font color=#0000FF><a href = "forth.html#2.0330" style="text-decoration: none; color: #0000FF">2dup</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">match</a> </font><font color=#00AAAA><a href = "root.html#1.2930" style="text-decoration: none; color: #00AAAA">if</a>                 &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>found 
           &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2710" style="text-decoration: none; color: #FF00FF">rdrop</a> <a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a> <a href = "root.html#1.2180" style="text-decoration: none; color: #FF00FF">r></a> <a href = "root.html#1.2080" style="text-decoration: none; color: #FF00FF">+</a> 
           &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1170" style="text-decoration: none; color: #00AAAA">[</a> </font><font color=#AA00AA><a href = "root.html#1.0050" style="text-decoration: none; color: #AA00AA">cellbits</a> </font><font color=#AA0000>8 </font><font color=#0000FF><a href = "forth.html#2.0490" style="text-decoration: none; color: #0000FF">/</a> </font><font color=#AA0000>1 </font><font color=#FF00FF><a href = "root.html#1.2080" style="text-decoration: none; color: #FF00FF">+</a> </font><font color=#00AAAA><a href = "root.html#1.1180" style="text-decoration: none; color: #00AAAA">]</a> <a href = "root.html#1.1260" style="text-decoration: none; color: #00AAAA">literal</a> </font><font color=#FF00FF><a href = "root.html#1.2080" style="text-decoration: none; color: #FF00FF">+</a> 
           &nbsp;</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">)c@f</a> </font><font color=#00AAAA><a href = "root.html#1.1230" style="text-decoration: none; color: #00AAAA">exit</a> 
        &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2950" style="text-decoration: none; color: #00AAAA">then</a> 
     &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2950" style="text-decoration: none; color: #00AAAA">then</a> </font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">)c@f</a> </font><font color=#FF00FF><a href = "root.html#1.2180" style="text-decoration: none; color: #FF00FF">r></a>  <a href = "root.html#1.2710" style="text-decoration: none; color: #FF00FF">rdrop</a>              &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>end flash read 
  &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a> <a href = "root.html#1.2150" style="text-decoration: none; color: #FF00FF">0=</a> </font><font color=#00AAAA><a href = "root.html#1.2920" style="text-decoration: none; color: #00AAAA">until</a>                        &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>not found 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 

</font><font color=#00AAAA><a href = "root.html#1.1210" style="text-decoration: none; color: #00AAAA">:</a> </font><font color=#FF0000>hfind  </font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>addr len -- addr len | 0 ht  \ search the search order 
  &nbsp;</font><font color=#AA00AA><a href = "root.html#1.0077" style="text-decoration: none; color: #AA00AA">#order</a> </font><font color=#0000FF><a href = "forth.html#2.0210" style="text-decoration: none; color: #0000FF">@</a>  </font><font color=#00AAAA><a href = "root.html#1.2900" style="text-decoration: none; color: #00AAAA">begin</a>  </font><font color=#FF00FF><a href = "root.html#1.2100" style="text-decoration: none; color: #FF00FF">dup</a>  </font><font color=#00AAAA><a href = "root.html#1.2960" style="text-decoration: none; color: #00AAAA">while</a>  </font><font color=#0000FF><a href = "forth.html#2.0370" style="text-decoration: none; color: #0000FF">1-</a>     &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>addr len idx 
     &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2700" style="text-decoration: none; color: #FF00FF">dup>r</a>  </font><font color=#0000FF><a href = "forth.html#2.0170" style="text-decoration: none; color: #0000FF">cells</a> </font><font color=#AA00AA><a href = "root.html#1.0078" style="text-decoration: none; color: #AA00AA">orders</a> </font><font color=#FF00FF><a href = "root.html#1.2080" style="text-decoration: none; color: #FF00FF">+</a> </font><font color=#0000FF><a href = "forth.html#2.0210" style="text-decoration: none; color: #0000FF">@</a> <a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">_hfind</a>   &nbsp;</font><font color=#00AAAA><a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>addr len 0/ht 
     &nbsp;</font><font color=#0000FF><a href = "forth.html#2.0325" style="text-decoration: none; color: #0000FF">?dup</a> </font><font color=#00AAAA><a href = "root.html#1.2930" style="text-decoration: none; color: #00AAAA">if</a> 
        &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2710" style="text-decoration: none; color: #FF00FF">rdrop</a> </font><font color=#0000FF><a href = "forth.html#2.0340" style="text-decoration: none; color: #0000FF">2drop</a> </font><font color=#AA0000>0 </font><font color=#FF00FF><a href = "root.html#1.2120" style="text-decoration: none; color: #FF00FF">swap</a> </font><font color=#00AAAA><a href = "root.html#1.1230" style="text-decoration: none; color: #00AAAA">exit</a>       &nbsp;<a href = "root.html#1.1020" style="text-decoration: none; color: #00AAAA">\</a> </font><font color=#008800>found, exit 
     &nbsp;</font><font color=#00AAAA><a href = "root.html#1.2950" style="text-decoration: none; color: #00AAAA">then</a> 
  &nbsp;</font><font color=#FF00FF><a href = "root.html#1.2180" style="text-decoration: none; color: #FF00FF">r></a> </font><font color=#00AAAA><a href = "root.html#1.2970" style="text-decoration: none; color: #00AAAA">repeat</a>  </font><font color=#FF00FF><a href = "root.html#1.2130" style="text-decoration: none; color: #FF00FF">drop</a> 
</font><font color=#00AAAA><a href = "root.html#1.1240" style="text-decoration: none; color: #00AAAA">;</a> 

</font><font color=#0000FF><a href = "forth.html#(null)" style="text-decoration: none; color: #0000FF">decimal</a> </font><font color=#00AAAA><a href = "root.html#1.1290" style="text-decoration: none; color: #00AAAA">there</a> </font><font color=#FF00FF><a href = "root.html#1.2120" style="text-decoration: none; color: #FF00FF">swap</a> <a href = "root.html#1.2090" style="text-decoration: none; color: #FF00FF">-</a> </font><font color=#0000FF><a href = "forth.html#2.3300" style="text-decoration: none; color: #0000FF">.</a> </font><font color=#00AAAA><a href = "root.html#1.1030" style="text-decoration: none; color: #00AAAA">.(</a> </font><font color=#008800>instructions used by flash )</font><font color=#0000FF><a href = "forth.html#2.2111" style="text-decoration: none; color: #0000FF">cr</a> 
</pre>
</body>
</html>
